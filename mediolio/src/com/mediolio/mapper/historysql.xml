<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="ht">
  	<select id="historyList" parameterType="int" resultType="htvo">
  		select h.ht_id, h.ht_title, h.ht_public, h.ht_introduce, c.cl_name class_name from history h, class c 
  		where h.m_id=#{m_id} and h.cl_id=c.cl_id order by h.ht_lastedit desc
  	</select>
  	<insert id="addHistory" parameterType="htvo">
  		insert into history (ht_title,ht_introduce,cl_id,ht_lastedit,ht_createdate,m_id,ht_public) 
  		values (#{ht_title},#{ht_introduce},#{cl_id},sysdate(),sysdate(),#{m_id},#{ht_public})
  	</insert>
  	<delete id="deleteHistory" parameterType="int">
  		delete from history where ht_id=#{ht_id}
  	</delete>
  	<select id="branchList" parameterType="int" resultType="brvo">
  		select * from branch where ht_id=#{ht_id} order by br_date desc
  	</select>
  	<insert id="addBranch" parameterType="brvo">
  		insert into branch (ht_id,br_title,br_img1,br_img2,br_img3,br_text,br_date,br_public) 
  		values (#{ht_id},#{br_title},#{br_img1},#{br_img2},#{br_img3},#{br_text},sysdate(),#{br_public})
  	</insert>
  	<delete id="deleteBranch" parameterType="int">
  		delete from branch where br_id=#{br_id}
  	</delete>
  	<update id="updateLastEdit" parameterType="int">
  		update history set ht_lastedit=sysdate() where ht_id=#{ht_id}
  	</update>
  	<select id="autocompleteClass" parameterType="String" resultType="clvo">
  		select * from class where cl_name like CONCAT('%',#{cl_name},'%') 
  		order by cl_name
  	</select>
  	<update id="changeHtPublic" parameterType="htvo">
		update history set ht_public=#{ht_public} where ht_id=#{ht_id}  	
  	</update>
  </mapper>