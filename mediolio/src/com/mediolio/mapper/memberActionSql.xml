<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="ma">
    <insert id="projectLike" parameterType="mavo">
		INSERT INTO member_action (act_type, act_to, act_from, p_id, act_date, act_read) VALUES ('like', #{act_to}, #{act_from},#{p_id}, now(), 'n')
	</insert>
	
	<delete id="projectLikeCancel" parameterType="mavo">
		DELETE FROM member_action WHERE act_type='like' AND act_from=#{act_from} AND p_id=#{p_id}
	</delete>
		
  	<select id="getProjectLike" parameterType="int" resultType="int">
		SELECT count(*) from member_action WHERE act_type='like' AND p_id=#{p_id}
	</select>
	
  	<insert id="msgSend" parameterType="msvo">
		INSERT INTO message (msg_from, msg_to, msg_text, msg_date, msg_from_status, msg_to_status) VALUES (#{msg_from}, #{msg_to}, #{msg_text}, now(), 'sent', 'no-read')
	</insert>
	
	<select id="getMsgListReceived" parameterType="int" resultType="msvo">
		SELECT * FROM message WHERE msg_to = #{msg_to} AND msg_to_status != 'deleted' ORDER BY msg_id DESC
	</select>
	
	<select id="getMsgListSent" parameterType="int" resultType="msvo">
		SELECT * FROM message WHERE msg_from = #{from} AND msg_from_status = 'sent' ORDER BY msg_id DESC
	</select>
	
	<update id="deleteMsgSent" parameterType="int">
		UPDATE message SET msg_from_status = 'deleted' WHERE msg_id = #{msg_id}
	</update>
	
	<update id="deleteMsgReceived" parameterType="int">
		UPDATE message SET msg_to_status = 'deleted' WHERE msg_id = #{msg_id}
	</update>
	
	<update id="readMsgReceived" parameterType ="int">
		UPDATE message SET msg_to_status='read' WHERE msg_id = #{msg_id}
	</update>
	
	<insert id="followMember" parameterType="mavo">
		INSERT INTO member_action (act_type, act_to, act_from, act_date, act_read) VALUES ('follow', #{act_to}, #{act_from}, now(), 'n')
	</insert>
	
	<delete id="followCancel" parameterType="mavo">
		DELETE FROM member_action WHERE act_type='follow' AND act_from=#{act_from} AND act_to=#{act_to}
	</delete>
	
	<select id="followCheck" parameterType = "mavo" resultType="int">
		SELECT count(*) from member_action WHERE act_type='follow' AND act_from=#{act_from} AND act_to=#{act_to}
	</select>

  </mapper>
  
